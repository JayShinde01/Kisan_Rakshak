<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="description" content="KisanRakshak â€“ Smart farming assistant">

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Google Sign-in -->
  <meta name="google-signin-client_id"
        content="896246335749-o54uhcdne9n4rpuq851mn2bjtr109ju6.apps.googleusercontent.com">
  <meta name="credentialless" content="true">

  <!-- iOS meta -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="KisanRakshak">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>KisanRakshak</title>
  <link rel="manifest" href="manifest.json">

  <!-- ========================= -->
  <!-- ðŸ”¥ FIREBASE SDK           -->
  <!-- ========================= -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB_zDPZWQQWILhAvJ9gGDZN-e-U8M5nnFI",
      authDomain: "login-1665b.firebaseapp.com",
      projectId: "login-1665b",
      storageBucket: "login-1665b.firebasestorage.app",
      messagingSenderId: "896246335749",
      appId: "1:896246335749:web:bc4e05033beb810391cf6c",
      measurementId: "G-5TXPF4056R"
    };

    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  </script>

  <!-- ========================= -->
  <!-- ðŸ¤– JOTFORM CHATBOT FIX    -->
  <!-- ========================= -->
  <style>
    /* Base chatbot positioning */
    iframe[src*="jotfor.ms"],
    div[id*="jotform"],
    div[class*="jotform"],
    div[class*="agent"] {
      position: fixed !important;
      bottom: 120px !important; /* ABOVE bottom nav */
      right: 16px !important;
      z-index: 9999 !important;
    }

    /* Mobile phones */
    @media (max-width: 600px) {
      iframe[src*="jotfor.ms"],
      div[id*="jotform"],
      div[class*="jotform"],
      div[class*="agent"] {
        bottom: 10px !important; /* clears nav + FAB */
        right: 3px !important;
        transform: scale(0.95);
      }
    }

    /* Tablets */
    @media (min-width: 601px) and (max-width: 1024px) {
      iframe[src*="jotfor.ms"],
      div[id*="jotform"],
      div[class*="jotform"],
      div[class*="agent"] {
        bottom: 110px !important;
        right: 20px !important;
      }
    }

    /* Desktop */
    @media (min-width: 1025px) {
      iframe[src*="jotfor.ms"],
      div[id*="jotform"],
      div[class*="jotform"],
      div[class*="agent"] {
        bottom: 32px !important;
        right: 32px !important;
      }
    }
  </style>

</head>

<body>

  <!-- Jotform Chatbot -->
  <script>
  function loadJotformBot() {
    if (document.getElementById("jotform-chatbot")) return;

    const script = document.createElement("script");
    script.id = "jotform-chatbot";
    script.src =
      "https://cdn.jotfor.ms/agent/embedjs/019b02bac0887d99ae37356ecd239e719a6b/embed.js";
    script.async = true;
    document.body.appendChild(script);

    console.log("ðŸ¤– Jotform chatbot loaded");
  }

  function removeJotformBot() {
    const script = document.getElementById("jotform-chatbot");
    if (script) script.remove();

    // Also remove iframe if already created
    document
      .querySelectorAll('iframe[src*="jotfor.ms"]')
      .forEach((el) => el.remove());

    console.log("ðŸ—‘ï¸ Jotform chatbot removed");
  }

  // âœ… THIS is the key fix
  firebase.auth().onAuthStateChanged((user) => {
    if (user) {
      loadJotformBot();   // login â†’ show bot
    } else {
      removeJotformBot(); // logout â†’ hide bot
    }
  });
</script>


  <!-- Flutter -->
  <script src="flutter_bootstrap.js" async></script>

</body>
</html>
